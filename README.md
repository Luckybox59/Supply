# Parser GUI

Инструмент для парсинга счетов (PDF/XLS/XLSX), извлечения структурированных данных через LLM (OpenRouter), сравнения заявки и счета и отправки письма с вложениями. Поддерживается только GUI (Tkinter).

## Возможности
- Парсинг PDF через `pdfplumber`, fallback на OCR (`pdf2image` + `easyocr`).
- Парсинг `.xls` (xlrd 1.2.0) и `.xlsx` (pandas + openpyxl).
- Отправка всех выбранных файлов одним запросом в LLM, валидация результата Pydantic-схемами.
- Сравнение 1 заявки и 1 счета, генерация отчета (Jinja2-шаблон `Шаблон отчета для Parser.md.j2`).
- Формирование текста письма и отправка через SMTP, отметка папки заказа как оплаченной.
- Результаты сохраняются рядом с исходными файлами: на каждый документ создается `<имя>_extracted.json`, общий отчет — `comparison_report.md`, карточка — `Карточка изделия.txt`.

## Установка
1. Установите зависимости Python:
```
pip install -r requirements.txt
```
2. Установите Poppler и укажите путь в `config.POPPLER_PATH` (по умолчанию: `D:/Program files/poppler-24.08.0/Library/bin`).
3. Подготовьте секреты (OpenRouter, SMTP):
   - Рекомендуется использовать переменные окружения или `.env` (если подключите `python-dotenv`).
   - Либо заполните `secrets.json` (файл игнорируется гитом).

Минимальные переменные:
- `OPENROUTER_API_KEY`
- `OPENROUTER_BASE_URL` (опционально)
- `OPENROUTER_MODEL` (опционально)
- `SMTP_SERVER`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASSWORD`, `FROM_EMAIL`

Примечание по зависимостям:
- Для метрик производительности используется `psutil` (см. `requirements.txt`).

## Запуск GUI
Запускайте из папки заказа (чтобы результаты сохранялись рядом со счетами):
```
python gui.py
```

## Настройки
- `config.py` объединяет значения из `secrets.json` и переменных окружения.
- `settings.json` хранит не секретные настройки (модель по умолчанию, тема-пометка и т.п.).
- Шаблон отчета: `Шаблон отчета для Parser.md.j2`.

## Примечания
- `secrets.json` включен в `.gitignore` и не должен попадать в репозиторий.
- OCR (easyocr) требует torch — установка может занять время.
- Для старых `.xls` используется `xlrd==1.2.0`.
